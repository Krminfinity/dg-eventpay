# 詳細設計 - 手数料/精算ロジック

更新日: 2025-08-30
状態: ドラフト v0

## 料金モデル
- プラットフォーム手数料 = rate% × 金額 + fixed_fee（税別）
- PG手数料 = 決済種別ごと（実費）
- 消費税: 手数料に対して課税（内税/外税設定）

## イベント単位の収支
- 売上合計 = Σ captured payment.amount
- 返金合計 = Σ refund.amount（成功分）
- 売上純額 = 売上合計 - 返金合計
- 手数料合計 = Σ(プラットフォーム手数料) + Σ(PG手数料)
- 受取額（net）= 売上純額 - 手数料合計 ± 調整（チャージバック/過不足）

## 返金時の手数料扱い
- プラットフォーム手数料の返戻有無は設定で制御（default: 返戻しない）
- PG手数料は原則返戻なし（PG規約次第）

## チャージバック
- 該当イベントの次回Payoutで控除
- 受取額がマイナスとなる場合は繰越（negative balance）

## 端数/丸め
- 金額は最小通貨単位（JPYは1円）。
- 小数計算はDecimal。手数料単位で四捨五入、イベント合算で再度丸め。

## 振込サイクル
- 週次例: 毎週金曜締め、翌週水曜振込（営業日調整）
- コンビニ払いは入金確認後に売上計上
